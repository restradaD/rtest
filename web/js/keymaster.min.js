(function(u){var v,B={},A={16:false,18:false,17:false,91:false},r="all",e={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},f={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},a=function(k){return f[k]||k.toUpperCase().charCodeAt(0)},x=[];for(v=1;v<20;v++){f["f"+v]=111+v}function h(F,E){var k=F.length;while(k--){if(F[k]===E){return k}}return -1}function y(E,k){if(E.length!=k.length){return false}for(var F=0;F<E.length;F++){if(E[F]!==k[F]){return false}}return true}var q={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function i(k){for(v in A){A[v]=k[q[v]]}}function C(J){var G,I,E,F,K,H;G=J.keyCode;if(h(x,G)==-1){x.push(G)}if(G==93||G==224){G=91}if(G in A){A[G]=true;for(E in e){if(e[E]==G){g[E]=true}}return}i(J);if(!g.filter.call(this,J)){return}if(!(G in B)){return}H=n();for(F=0;F<B[G].length;F++){I=B[G][F];if(I.scope==H||I.scope=="all"){K=I.mods.length>0;for(E in A){if((!A[E]&&h(I.mods,+E)>-1)||(A[E]&&h(I.mods,+E)==-1)){K=false}}if((I.mods.length==0&&!A[16]&&!A[18]&&!A[17]&&!A[91])||K){if(I.method(J,I)===false){if(J.preventDefault){J.preventDefault()}else{J.returnValue=false}if(J.stopPropagation){J.stopPropagation()}if(J.cancelBubble){J.cancelBubble=true}}}}}}function d(H){var G=H.keyCode,E,F=h(x,G);if(F>=0){x.splice(F,1)}if(G==93||G==224){G=91}if(G in A){A[G]=false;for(E in e){if(e[E]==G){g[E]=false}}}}function j(){for(v in A){A[v]=false}for(v in e){g[v]=false}}function g(E,F,I){var H,G;H=b(E);if(I===undefined){I=F;F="all"}for(var k=0;k<H.length;k++){G=[];E=H[k].split("+");if(E.length>1){G=w(E);E=[E[E.length-1]]}E=E[0];E=a(E);if(!(E in B)){B[E]=[]}B[E].push({shortcut:H[k],scope:F,method:I,key:H[k],mods:G})}}function z(G,H){var k,J,I=[],F,E,K;k=b(G);for(E=0;E<k.length;E++){J=k[E].split("+");if(J.length>1){I=w(J)}G=J[J.length-1];G=a(G);if(H===undefined){H=n()}if(!B[G]){return}for(F=0;F<B[G].length;F++){K=B[G][F];if(K.scope===H&&y(K.mods,I)){B[G][F]={}}}}}function c(k){if(typeof(k)=="string"){k=a(k)}return h(x,k)!=-1}function p(){return x.slice(0)}function l(E){var k=(E.target||E.srcElement).tagName;return !(k=="INPUT"||k=="SELECT"||k=="TEXTAREA")}for(v in e){g[v]=false}function m(k){r=k||"all"}function n(){return r||"all"}function s(G){var F,k,E;for(F in B){k=B[F];for(E=0;E<k.length;){if(k[E].scope===G){k.splice(E,1)}else{E++}}}}function b(k){var E;k=k.replace(/\s/g,"");E=k.split(",");if((E[E.length-1])==""){E[E.length-2]+=","}return E}function w(E){var F=E.slice(0,E.length-1);for(var k=0;k<F.length;k++){F[k]=e[F[k]]}return F}function t(k,E,F){if(k.addEventListener){k.addEventListener(E,F,false)}else{if(k.attachEvent){k.attachEvent("on"+E,function(){F(window.event)})}}}t(document,"keydown",function(k){C(k)});t(document,"keyup",d);t(window,"focus",j);var o=u.key;function D(){var E=u.key;u.key=o;return E}u.key=g;u.key.setScope=m;u.key.getScope=n;u.key.deleteScope=s;u.key.filter=l;u.key.isPressed=c;u.key.getPressedKeyCodes=p;u.key.noConflict=D;u.key.unbind=z;if(typeof module!=="undefined"){module.exports=g}})(this);